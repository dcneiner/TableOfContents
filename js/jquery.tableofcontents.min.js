/*
	TableOfContents Plugin for jQuery (by Doug Neiner)
	
	Edited by Dennis Stevense for Digital Deployment
	
	Version: 0.8-digitaldeployment
		
	Based on code and concept by Janko Jovanovic 
	  in his article: http://www.jankoatwarpspeed.com/post/2009/08/20/Table-of-contents-using-jQuery.aspx
	
	This plugin is offered under the MIT license.
	(c) 2009 by Doug Neiner, http://dougneiner.com
*/
(function(e){e.TableOfContents=function(g,f,h){var a=this;a.$el=e(g);a.el=g;a.toc="";a.listStyle=null;a.tags=["h1","h2","h3","h4","h5","h6"];a.init=function(){a.options=e.extend({},e.TableOfContents.defaultOptions,h);if(typeof f=="undefined"||f==null)f=document.body;a.$scope=e(f);var b=a.$scope.find(a.tags.join(", ")).filter(":first");if(b.length==1){a.starting_depth=a.options.startLevel;if(a.options.depth<1)a.options.depth=1;b=a.tags.splice(a.options.startLevel-1,a.options.depth);a.$headings=a.findHeadings(a.$scope,
b.join(", "));if(a.options.topLinks!==false){b=e(document.body).attr("id");if(b==""){b=a.options.topBodyId;document.body.id=b}a.topLinkId=b}if(a.$el.is("ul"))a.listStyle="ul";else if(a.$el.is("ol"))a.listStyle="ol";a.buildTOC();a.options.proportionateSpacing===true&&!a.tieredList()&&a.addSpacing();return a}};a.findHeadings=function(b,d,c){if(c===undefined)c=e([]);b.children().each(function(i,j){$child=e(j);c=$child.is(d)?c.add($child):a.findHeadings($child,d,c)});return c};a.tieredList=function(){return a.listStyle==
"ul"||a.listStyle=="ol"};a.buildTOC=function(){a.current_depth=a.starting_depth;a.$headings.each(function(b){var d=this.nodeName.toLowerCase().substr(1,1);if(b>0||b==0&&d!=a.current_depth)a.changeDepth(d);a.toc+=a.formatLink(this,d,b)+"\n";a.options.topLinks!==false&&a.addTopLink(this)});a.changeDepth(a.starting_depth,true);if(a.tieredList())a.toc="<li>\n"+a.toc+"</li>\n";a.$el.html(a.toc)};a.addTopLink=function(b){var d=a.options.topLinks===true?"Top":a.options.topLinks;d=e("<a href='#"+a.topLinkId+
"' class='"+a.options.topLinkClass+"'></a>").html(d);e(b).append(d)};a.formatLink=function(b,d){var c=b.id;if(c==""){c=a.buildSlug(e(b).text());b.id=c}c="<a href='#"+c+"'";a.tieredList()||(c+=" class='"+a.depthClass(d)+"'");c+=">"+a.options.levelText.replace("%",e(b).text())+"</a>";return c};a.changeDepth=function(b,d){if(d!==true)d=false;if(!a.tieredList()){a.current_depth=b;return true}if(b>a.current_depth){d=[];for(var c=a.current_depth;c<b;c++)d.push("<"+a.listStyle+">\n");c="<li>\n";a.toc+=d.join(c)+
c}else{if(b<a.current_depth){var i=[];for(c=a.current_depth;c>b;c--)i.push("</"+a.listStyle+">\n");a.toc+="</li>\n"+i.join("</li>\n")}d||(a.toc+="</li>\n<li>\n")}a.current_depth=b};a.buildSlug=function(b){b=b.toLowerCase().replace(/[^a-z0-9 -]/gi,"").replace(/ /gi,"-");return b=b.substr(0,50)};a.depthClass=function(b){return a.options.levelClass.replace("%",b-(a.starting_depth-1))};a.addSpacing=function(){var b=a.$headings.filter(":first").position().top;a.$headings.each(function(d){d=a.$el.find("a:eq("+
d+")");var c=(e(this).position().top-b)/(a.$scope.height()-b)*a.$el.height();d.css({position:"absolute",top:c})})};return a.init()};e.TableOfContents.defaultOptions={startLevel:1,depth:3,levelClass:"toc-depth-%",levelText:"%",topLinks:false,topLinkClass:"toc-top-link",topBodyId:"toc-top",proportionateSpacing:false};e.fn.tableOfContents=function(g,f){return this.each(function(){var h=new e.TableOfContents(this,g,f);delete h})}})(jQuery);
