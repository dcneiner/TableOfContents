/*
	TableOfContents Plugin for jQuery
	
	Programmed by Doug Neiner
	Additional Programming by Alexandre Leray, Tiou Lims, and Dennis Stevense (for Digital Deployment)
	
	Version: 0.9
		
	Based on code and concept by Janko Jovanovic 
	  in his article: http://www.jankoatwarpspeed.com/post/2009/08/20/Table-of-contents-using-jQuery.aspx
	
	This plugin is offered under the MIT license.
	(c) 2009-2014 by Doug Neiner, http://dougneiner.com
*/
(function(e){e.TableOfContents=function(t,n,r){var i=this;i.$el=e(t);i.el=t;i.toc="";i.listStyle=null;i.tags=["h1","h2","h3","h4","h5","h6"];i.init=function(){i.options=e.extend({},e.TableOfContents.defaultOptions,r);if(typeof n=="undefined"||n==null)n=document.body;i.$scope=e(n);i.starting_depth=i.options.startLevel;if(i.options.depth<1)i.options.depth=1;var t=i.tags.splice(i.options.startLevel-1,i.options.depth);i.$headings=i.findHeadings(i.$scope,t.join(", "));if(e.isFunction(i.options.exclude)){i.$headings=i.options.exclude(i.$headings,i.$scope)}if(i.$headings.length<i.options.minCount)return;if(i.options.topLinks!==false){var s=e(document.body).attr("id");if(s==""){s=i.options.topBodyId;document.body.id=s}i.topLinkId=s}if(i.$el.is("ul")){i.listStyle="ul"}else if(i.$el.is("ol")){i.listStyle="ol"}i.buildTOC();if(i.options.proportionateSpacing===true&&!i.tieredList()){i.addSpacing()}return i};i.findHeadings=function(t,n,r){if(r===undefined){r=e([])}t.children().each(function(t,s){$child=e(s);if($child.is(n)){r=r.add($child)}else{r=i.findHeadings($child,n,r)}});return r};i.tieredList=function(){return i.listStyle=="ul"||i.listStyle=="ol"};i.buildTOC=function(){i.current_depth=i.starting_depth;i.$headings.each(function(e,t){var n=this.nodeName.toLowerCase().substr(1,1);if(e>0||e==0&&n!=i.current_depth){i.changeDepth(n)}i.toc+=i.formatLink(this,n,e)+"\n";if(i.options.topLinks!==false)i.addTopLink(this)});i.changeDepth(i.starting_depth,true);if(i.tieredList())i.toc="<li>\n"+i.toc+"</li>\n";i.$el.html(i.toc)};i.addTopLink=function(t){var n=i.options.topLinks===true?"Top":i.options.topLinks;var r=e("<a href='#"+i.topLinkId+"' class='"+i.options.topLinkClass+"'></a>").html(n);e(t).append(r)};i.formatLink=function(t,n,r){var s=t.id;if(s==""){s=i.buildSlug(e(t).text());t.id=s}var o="<a href='#"+s+"'";if(!i.tieredList())o+=" class='"+i.depthClass(n)+"'";o+=">"+i.options.levelText.replace("%",e(t).text())+"</a>";return o};i.changeDepth=function(e,t){if(t!==true)t=false;if(!i.tieredList()){i.current_depth=e;return true}if(e>i.current_depth){var n=[];for(var r=i.current_depth;r<e;r++){n.push("<"+i.listStyle+">"+"\n")}var s="<li>\n";i.toc+=n.join(s)+s}else if(e<i.current_depth){var o=[];for(var r=i.current_depth;r>e;r--){o.push("</"+i.listStyle+">"+"\n")}i.toc+="</li>\n"+o.join("</li>"+"\n");if(!t){i.toc+="</li>\n<li>\n"}}else{if(!t){i.toc+="</li>\n<li>\n"}}i.current_depth=e};i.buildSlug=function(e){e=e.toLowerCase().replace(/[^a-z0-9 -]/gi,"").replace(/ /gi,"-");e=e.substr(0,50);return e};i.depthClass=function(e){return i.options.levelClass.replace("%",e-(i.starting_depth-1))};i.addSpacing=function(){var t=i.$headings.filter(":first").position().top;i.$headings.each(function(n,r){var s=i.$el.find("a:eq("+n+")");var o=(e(this).position().top-t)/(i.$scope.height()-t)*i.$el.height();s.css({position:"absolute",top:o})})};return i.init()};e.TableOfContents.defaultOptions={startLevel:1,depth:3,levelClass:"toc-depth-%",levelText:"%",topLinks:false,topLinkClass:"toc-top-link",topBodyId:"toc-top",proportionateSpacing:false,exclude:function(e,t){return e},minCount:1};e.fn.tableOfContents=function(t,n){return this.each(function(){var r=new e.TableOfContents(this,t,n);delete r})}})(jQuery)